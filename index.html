<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Class Resources</title>
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

<header>
  <div class="container">
    <h1>Class Resources</h1>
    <p>BCA - 6th Semester</p>
  </div>
</header>

<main class="container" id="main-content">
  <p class="loading-text">Loading resources...</p>
</main>

<footer>
  <p>Hosted on GitHub Pages</p>
</footer>

<script>
  const CONFIG = {
    username: 'ShadowAmitendu',
    repo: 'ClassResources',
    folders: [
      { path: 'syllabus', title: 'üìÇ Syllabus' },
      { path: 'notes', title: 'üìù Notes' },
      { path: 'assignments', title: 'üì¶ Assignments & Misc' }
    ]
  };

  async function init() {
    const main = document.getElementById('main-content');
    main.innerHTML = '';

    for (const folder of CONFIG.folders) {
      const section = document.createElement('section');
      section.className = 'category';

      const title = document.createElement('h2');
      title.textContent = folder.title;
      section.appendChild(title);

      const ul = document.createElement('ul');
      ul.className = 'file-list';
      ul.innerHTML = '<li class="loading-item">Fetching...</li>';
      section.appendChild(ul);

      main.appendChild(section);

      // Start fetching contents
      await fetchContents(folder.path, ul);
    }
  }

  async function fetchContents(path, container) {
    try {
      const response = await fetch(`https://api.github.com/repos/${CONFIG.username}/${CONFIG.repo}/contents/${path}`);

      if (response.status === 404) {
        container.innerHTML = '<li class="empty-msg">Folder not found.</li>';
        return;
      }

      const data = await response.json();

      // Clear "Loading..." text only if it's the top-level container
      if (container.querySelector('.loading-item')) {
        container.innerHTML = '';
      }

      if (data.length === 0) {
        container.innerHTML = '<li class="empty-msg">No files here.</li>';
        return;
      }

      // Sort: Folders first, then files
      data.sort((a, b) => (a.type === b.type ? 0 : a.type === 'dir' ? -1 : 1));

      for (const item of data) {
        if (item.type === 'file') {
          const li = document.createElement('li');
          const a = document.createElement('a');
          a.href = item.download_url;
          a.textContent = item.name;
          a.target = '_blank';
          li.appendChild(a);
          container.appendChild(li);
        }
        else if (item.type === 'dir') {
          // Create a list item for the folder
          const li = document.createElement('li');
          li.className = 'folder-item';

          // Folder Label
          const folderLabel = document.createElement('div');
          folderLabel.className = 'folder-label';
          folderLabel.textContent = 'üìÅ ' + item.name;
          li.appendChild(folderLabel);

          // Nested List
          const nestedUl = document.createElement('ul');
          nestedUl.className = 'sub-file-list';
          li.appendChild(nestedUl);

          container.appendChild(li);

          // Recursive call to fetch inside this folder
          await fetchContents(item.path, nestedUl);
        }
      }

    } catch (error) {
      console.error(error);
      container.innerHTML = `<li class="error-msg">Error loading contents.</li>`;
    }
  }

  init();
</script>
</body>
</html>